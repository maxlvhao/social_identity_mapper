<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Identity Mapping</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <a href="/researcher.html" class="researcher-link" id="researcher-link">Researcher</a>
  <div id="app">
    <!-- Progress Bar -->
    <header id="progress-header" class="hidden">
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
      <div class="progress-steps">
        <span class="step" data-step="1">1. Communal Life</span>
        <span class="step" data-step="2">2. Details</span>
        <span class="step" data-step="3">3. Position</span>
        <span class="step" data-step="4">4. Connections</span>
        <span class="step" data-step="5">5. Complete</span>
      </div>
    </header>

    <!-- Step 0: Landing -->
    <section id="step-landing" class="step-screen active">
      <div class="step-content centered">
        <h1>Social Identity Mapping</h1>
        <p class="subtitle">Explore your communities and how you belong.</p>

        <div class="session-info">
          <span>Session ID:</span>
          <code id="session-display">--</code>
        </div>

        <div class="intro-text">
          <p>In this activity, you will:</p>
          <ol>
            <li>List the groups and communities you spend time with</li>
            <li>Provide details about each group</li>
            <li>Map your groups visually based on information overlap</li>
            <li>Draw connections showing how easily topics flow between groups</li>
          </ol>
          <p>Your progress is saved automatically.</p>
        </div>

        <button id="start-btn" class="btn btn-primary btn-large">Begin Activity</button>
      </div>
    </section>

    <!-- Step 1: Add Communities -->
    <section id="step-1" class="step-screen">
      <div class="step-content">
        <div class="step-header">
          <h2>Step 1: Communal Life</h2>
          <p class="instruction">Think about your daily lifeâ€”who are the people and groups you spend time with, whether online or offline? These could be friends, family, coworkers, hobby groups, online communities, or something else. List them as you think of them. If you have distinct subgroups within a larger group, list them separately. For example, friends might be broken down as gym buddies or neighbours.</p>
        </div>

        <div class="input-section">
          <label for="new-community-input">Enter a community or group:</label>
          <div class="input-row">
            <input type="text" id="new-community-input" placeholder="">
            <button id="add-community-btn" class="btn btn-primary">Add</button>
          </div>
        </div>

        <div class="communities-list-section">
          <h3>Your Communities (<span id="communities-count">0</span>)</h3>
          <div id="communities-list" class="communities-list"></div>
          <p class="hint" id="communities-hint">Add at least 3 communities to continue.</p>
        </div>

        <div class="step-nav fixed-nav">
          <div></div>
          <button id="step1-next" class="btn btn-primary" disabled>Next</button>
        </div>
      </div>
    </section>

    <!-- Step 2: Community Details -->
    <section id="step-2" class="step-screen">
      <div class="step-content">
        <div class="step-header">
          <h2>Step 2: Community Details</h2>
          <p class="instruction">For each community, rate its importance and provide details about your relationship with it.</p>
        </div>

        <div class="details-questions">
          <div class="dq"><strong>Importance:</strong> How important is this community to you? (Very Important / Moderate / Less Important)</div>
          <div class="dq"><strong>Positivity:</strong> How positive do you feel about being a member? (1 = not at all positive, 10 = very positive)</div>
          <div class="dq"><strong>Contact:</strong> In a typical month, how many days would you engage with this community? (0-30 days)</div>
          <div class="dq"><strong>Tenure:</strong> For how many years have you been a member? (use decimals, e.g. 0.5 = 6 months)</div>
          <div class="dq"><strong>Representativeness:</strong> How well do you represent what it means to be a member? (1 = not at all, 10 = very well)</div>
        </div>

        <div class="details-table-container">
          <table class="details-table" id="details-table">
            <thead>
              <tr>
                <th>Community</th>
                <th>Importance</th>
                <th>Positivity<br><span class="th-hint">(1-10)</span></th>
                <th>Contact<br><span class="th-hint">(days)</span></th>
                <th>Tenure<br><span class="th-hint">(years)</span></th>
                <th>Representativeness<br><span class="th-hint">(1-10)</span></th>
              </tr>
            </thead>
            <tbody id="details-tbody"></tbody>
          </table>
        </div>

        <p class="hint" id="details-hint">Please fill in importance for all communities before continuing.</p>

        <div class="step-nav fixed-nav">
          <button id="step2-back" class="btn btn-secondary">Back</button>
          <button id="step2-next" class="btn btn-primary" disabled>Next</button>
        </div>
      </div>
    </section>

    <!-- Step 3: Position Groups -->
    <section id="step-3" class="step-screen">
      <div class="step-content">
        <div class="step-header compact">
          <h2>Step 3: Position</h2>
          <p class="instruction instruction-prominent">Place your communities on this map based on <strong>information overlap</strong>. Groups that share similar news topics or information should be placed <strong>closer together</strong>. Groups with little overlap should be placed <strong>further apart</strong>.</p>
        </div>

        <div id="canvas-container-step3" class="canvas-container flex-canvas">
          <div id="groups-canvas-3" class="groups-canvas"></div>
          <div id="drag-tutorial-3" class="tutorial-overlay">
            <div class="tutorial-content">
              <div class="tutorial-hand">ðŸ‘†</div>
              <p>Drag communities to position them</p>
            </div>
          </div>
        </div>

        <div class="step-nav fixed-nav">
          <button id="step3-back" class="btn btn-secondary">Back</button>
          <button id="step3-next" class="btn btn-primary">Next</button>
        </div>
      </div>
    </section>

    <!-- Step 4: Connections -->
    <section id="step-4" class="step-screen">
      <div class="step-content">
        <div class="step-header compact">
          <h2>Step 4: Connections</h2>
          <p class="instruction instruction-prominent">Draw lines between groups based on how <strong>easy or difficult</strong> it would be to discuss the same news topic across them. If members of two groups were to talk about a news topic together, would the conversation flow easily or be difficult?</p>
        </div>

        <div id="canvas-container-step4" class="canvas-container flex-canvas">
          <svg id="connections-svg" class="connections-layer"></svg>
          <svg id="drawing-svg" class="drawing-layer"></svg>
          <div id="groups-canvas-4" class="groups-canvas locked"></div>
          <div id="drag-tutorial-4" class="tutorial-overlay">
            <div class="tutorial-content">
              <div class="tutorial-hand">ðŸ‘†</div>
              <p>Drag from one community to another to connect them</p>
            </div>
          </div>
        </div>

        <div class="step-nav fixed-nav">
          <button id="step4-back" class="btn btn-secondary">Back</button>
          <button id="step4-next" class="btn btn-primary">Next</button>
        </div>
      </div>
    </section>

    <!-- Step 5: Complete -->
    <section id="step-5" class="step-screen">
      <div class="step-content">
        <div class="complete-header">
          <div class="complete-icon">âœ“</div>
          <h2>Activity Complete!</h2>
          <p>You mapped <strong id="final-communities">0</strong> communities with <strong id="final-connections">0</strong> connections.</p>
        </div>

        <div id="final-canvas-container" class="canvas-container final-preview">
          <svg id="final-connections-svg" class="connections-layer"></svg>
          <div id="final-groups-canvas" class="groups-canvas locked"></div>
        </div>

        <div class="qualtrics-reminder">
          <p><strong>Next step:</strong> Download your data file to save your responses.</p>
        </div>

        <div class="step-nav fixed-nav">
          <button id="back-to-edit" class="btn btn-secondary">Back</button>
          <button id="download-btn" class="btn btn-primary">Download My Data</button>
        </div>
      </div>
    </section>
  </div>

  <!-- Connection Type Modal -->
  <div id="connection-modal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content compact-modal">
      <p class="modal-question" id="modal-question">How easy would it be to discuss the same news topic across these two groups?</p>

      <div class="connection-options-row">
        <button class="conn-option-compact" data-type="easy">
          <svg width="40" height="12"><line x1="0" y1="6" x2="40" y2="6" class="conn-easy"/></svg>
          <span>Easy</span>
        </button>
        <button class="conn-option-compact" data-type="moderate">
          <svg width="40" height="12"><path d="M0,6 Q10,0 20,6 Q30,12 40,6" class="conn-moderate" fill="none"/></svg>
          <span>Moderate</span>
        </button>
        <button class="conn-option-compact" data-type="difficult">
          <svg width="40" height="12"><path d="M0,6 L8,1 L16,11 L24,1 L32,11 L40,6" class="conn-difficult" fill="none"/></svg>
          <span>Difficult</span>
        </button>
      </div>

      <div class="modal-actions">
        <button id="remove-conn-btn" class="btn btn-danger btn-small hidden">Remove</button>
        <button id="cancel-conn-btn" class="btn btn-secondary btn-small">Cancel</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
